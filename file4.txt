# CityFlow Visual Concepts Guide
## Understanding Traffic Simulation for PressLight

---

## ğŸ“ Part 1: Road Network Structure

### Single Intersection Layout

```
                    North (N)
                      â†“ â†“
                   [road_3_1]
                      â†“ â†“
    West (W)         â•”â•â•—         East (E)
    â†’ â†’ â†’ [road_0_1] â•‘âŠ•â•‘ [road_1_2] â†’ â†’ â†’
                     â•šâ•â•
                      â†‘ â†‘
                   [road_1_4]
                      â†‘ â†‘
                    South (S)

    âŠ• = Traffic Signal Intersection
    â†’ = Traffic flow direction
    â• = Intersection area (15m width)
```

### 2-Intersection Arterial Network

```
    N1              N2
    â†“               â†“
W1â†’ âŠ• â†’E1  â•â•â•â–º  W2â†’ âŠ• â†’E2
    â†“               â†“
    S1              S2

â•â•â•â–º = Connecting arterial road (300m)
```

### Lane Structure (3-lane arterial road)

```
Road: road_0_1 (West to East)

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Lane 0 (Index 0)    â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’    â”‚  Left turn + Straight
â”‚ Lane 1 (Index 1)    â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’    â”‚  Straight
â”‚ Lane 2 (Index 2)    â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’â†’    â”‚  Straight + Right turn
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Each lane: 3.0m wide, max speed 16.67 m/s (60 km/h)
```

---

## ğŸš¦ Part 2: Traffic Signal Phases

### 4-Phase Signal System

```
Phase 0: East-West Straight
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         âŠ— (Red)
            â”‚
    ğŸŸ¢ â”€â”€â”€â”€ âŠ• â”€â”€â”€â”€ ğŸŸ¢
            â”‚
         âŠ— (Red)

Phase 1: North-South Straight
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         ğŸŸ¢ (Green)
            â”‚
    âŠ— â”€â”€â”€â”€ âŠ• â”€â”€â”€â”€ âŠ—
            â”‚
         ğŸŸ¢ (Green)

Phase 2: East-West Left Turn
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         â†“
         âŠ—
    ğŸŸ¢ â†º  âŠ•  â†» ğŸŸ¢
         âŠ—
         â†‘

Phase 3: North-South Left Turn
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
         ğŸŸ¢
       â†™    â†–
    âŠ—  âŠ•  âŠ—
       â†˜    â†—
         ğŸŸ¢
```

### Phase Timing (Standard)

| Phase | Movement | Duration | Purpose |
|-------|----------|----------|---------|
| 0 | EW Straight | 30s | Main arterial flow |
| 1 | NS Straight | 20s | Side street flow |
| 2 | EW Left | 10s | Left turn clearance |
| 3 | NS Left | 10s | Left turn clearance |

**Total Cycle: 70 seconds**

---

## ğŸš— Part 3: Vehicle Movement

### Vehicle Parameters

```python
{
    "length": 5.0,        # 5 meters (typical car)
    "width": 2.0,         # 2 meters
    "maxSpeed": 16.67,    # 60 km/h = 16.67 m/s
    "maxPosAcc": 2.0,     # Acceleration: 2 m/sÂ²
    "maxNegAcc": 4.5,     # Braking: 4.5 m/sÂ²
    "minGap": 2.5,        # Min distance to vehicle ahead
    "headwayTime": 2.0    # Time gap (seconds)
}
```

### Car-Following Model

```
Vehicle Spacing Visualization:

[Car A]â”€â”€2.5mâ”€â”€[Car B]â”€â”€2.5mâ”€â”€[Car C]

If Car A brakes:
    Car B starts braking after 2.0s (headway time)
    Car B stops with minGap = 2.5m from Car A
```

### Lane Vehicle Distribution

```
PressLight State: 3 Segments per Lane

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Segment 2 (Far)   â”‚ ğŸš— ğŸš— ğŸš—      â”‚  â† Vehicles enter here
â”‚  Segment 1 (Mid)   â”‚ ğŸš— ğŸš—         â”‚
â”‚  Segment 0 (Near)  â”‚ ğŸš—            â”‚  â† Closest to intersection
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
                  [Intersection]

Each segment: ~100m (assuming 300m total road length)
```

---

## ğŸ“Š Part 4: PressLight State Representation

### 18-Dimensional State Vector

```
Index | Description           | Value Range | Example
â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€
0-1   | Phase encoding       | {0, 1}      | [1, 0]
2-4   | East incoming (3seg) | [0.0, 1.0]  | [0.5, 0.3, 0.2]
5-7   | West incoming        | [0.0, 1.0]  | [0.4, 0.4, 0.3]
8-10  | North incoming       | [0.0, 1.0]  | [0.6, 0.5, 0.4]
11-13 | South incoming       | [0.0, 1.0]  | [0.3, 0.2, 0.1]
14    | East outgoing        | [0.0, 1.0]  | 0.4
15    | West outgoing        | [0.0, 1.0]  | 0.3
16    | North outgoing       | [0.0, 1.0]  | 0.5
17    | South outgoing       | [0.0, 1.0]  | 0.2

Normalized by capacity: value = vehicles / max_capacity
```

### State Extraction Example

```python
# Intersection has:
# - East: 15 vehicles across 3 lanes
# - Capacity per lane: 10 vehicles
# - Total capacity: 30 vehicles

vehicles_east = 15
normalized = vehicles_east / 30 = 0.5

# Split into 3 segments (simplified):
segment_0 = 0.5 / 3 = 0.17
segment_1 = 0.5 / 3 = 0.17
segment_2 = 0.5 / 3 = 0.17

state[2:5] = [0.17, 0.17, 0.17]
```

---

## ğŸ’¡ Part 5: Pressure Calculation

### Concept Visualization

```
Incoming Flow vs Outgoing Flow

High Pressure (Bad):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Incoming: ğŸš—ğŸš—ğŸš—ğŸš—ğŸš— (15 vehicles)
           â†“ â†“ â†“
        [Intersection]
           â†“ â†“
Outgoing:  ğŸš—ğŸš— (5 vehicles)

Pressure = |15 - 5| = 10 (High!)
â†’ Queue building up


Low Pressure (Good):
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Incoming: ğŸš—ğŸš—ğŸš— (8 vehicles)
           â†“ â†“
        [Intersection]
           â†“ â†“
Outgoing:  ğŸš—ğŸš—ğŸš— (7 vehicles)

Pressure = |8 - 7| = 1 (Low!)
â†’ Balanced flow
```

### Pressure Formula

```python
pressure = 0
for direction in ['E', 'W', 'N', 'S']:
    incoming_normalized = vehicles_in / capacity_in
    outgoing_normalized = vehicles_out / capacity_out
    
    pressure += abs(incoming_normalized - outgoing_normalized)

reward = -pressure  # We want to minimize pressure!
```

### Example Calculation

```
Intersection State:
- East: 20 in, 10 out â†’ |20/30 - 10/30| = 0.33
- West: 15 in, 8 out  â†’ |15/30 - 8/30|  = 0.23
- North: 10 in, 5 out â†’ |10/20 - 5/20|  = 0.25
- South: 5 in, 3 out  â†’ |5/20 - 3/20|   = 0.10

Total Pressure = 0.33 + 0.23 + 0.25 + 0.10 = 0.91
Reward = -0.91
```

---

## ğŸ”„ Part 6: Simulation Flow

### One Time Step (1 second)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Vehicle Arrivals                         â”‚
â”‚    - New vehicles spawn based on flow.json  â”‚
â”‚    - Enter at road entry points             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Vehicle Movement                          â”‚
â”‚    - Cars follow car-following model         â”‚
â”‚    - Respect speed limits and gaps           â”‚
â”‚    - Lane changing (if enabled)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Traffic Light Control                     â”‚
â”‚    - Agent selects phase (if RL)             â”‚
â”‚    - Or follow fixed timing                  â”‚
â”‚    - Update signal states                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Intersection Processing                   â”‚
â”‚    - Vehicles cross if green light           â”‚
â”‚    - Queue at red lights                     â”‚
â”‚    - Turn movements                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. State Update                              â”‚
â”‚    - Update vehicle positions                â”‚
â”‚    - Calculate metrics (queue, delay, etc.)  â”‚
â”‚    - Prepare state for next step             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Episode Structure

```
Episode (3600 steps = 1 hour simulation)

â”œâ”€ Step 0: Initialize
â”‚  â””â”€ Reset all vehicles
â”‚  â””â”€ Set initial phases
â”‚
â”œâ”€ Step 1-3600: Main Loop
â”‚  â”œâ”€ Get state
â”‚  â”œâ”€ Agent selects action
â”‚  â”œâ”€ Execute action (set phase)
â”‚  â”œâ”€ Simulate 1 second
â”‚  â”œâ”€ Calculate reward
â”‚  â””â”€ Train agent
â”‚
â””â”€ Episode End: Evaluate
   â””â”€ Calculate average travel time
   â””â”€ Calculate throughput
   â””â”€ Save statistics
```

---

## ğŸ¯ Part 7: Action Space

### Phase Selection

```
Action Space: {0, 1, 2, 3}

Agent Output: Q-values for each action
[Qâ‚€, Qâ‚, Qâ‚‚, Qâ‚ƒ] = [0.8, 0.5, 0.3, 0.4]
                     â†‘ highest
Selected Action = 0 (EW Straight)
```

### Phase Transitions

```
Phase 0 (EW) â†’ Phase 1 (NS)

Before (EW Green):
    âŠ— â”€â”€â”€ âŠ• â”€â”€â”€ âŠ—
         ğŸŸ¢
         
After (NS Green):
         ğŸŸ¢
    âŠ— â”€â”€â”€ âŠ• â”€â”€â”€ âŠ—
         ğŸŸ¢

CityFlow handles yellow phase automatically
(typically 3-5 seconds transition time)
```

---

## ğŸ“ˆ Part 8: Metrics and Evaluation

### Key Performance Indicators

```
1. Average Travel Time
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Time from vehicle spawn to exit
   
   Good: < 100s
   Fair: 100-200s
   Poor: > 200s

2. Average Queue Length
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Vehicles waiting at red lights
   
   Good: < 5 vehicles/lane
   Fair: 5-10 vehicles/lane
   Poor: > 10 vehicles/lane

3. Throughput
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Vehicles completing journey
   
   Goal: Maximize completed trips
```

### Performance Comparison Chart

```
Travel Time Comparison:

Fixed-Time:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 200s
Max-Pressure: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 150s
PressLight:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100s  â† TARGET

0s            100s           200s
```

---

## ğŸ”§ Part 9: Common Configuration Patterns

### Light Traffic (Testing)

```json
{
  "interval": 3.0,  // 1 vehicle every 3 seconds
  "vehicles": 1200  // per hour
}
```

### Heavy Traffic (Training)

```json
{
  "interval": 1.5,  // 1 vehicle every 1.5 seconds
  "vehicles": 2400  // per hour
}
```

### Peak Hour Pattern

```json
[
  {
    "interval": 3.0,
    "startTime": 0,
    "endTime": 1800     // First 30 min: light
  },
  {
    "interval": 1.0,
    "startTime": 1800,
    "endTime": 2700     // Middle 15 min: heavy
  },
  {
    "interval": 3.0,
    "startTime": 2700,
    "endTime": 3600     // Last 15 min: light
  }
]
```

---

## ğŸ“ Part 10: PressLight Training Process

### Training Visualization

```
Episode 0-100: Random Exploration
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ² Agent tries random actions
ğŸ“Š Metrics: Poor (travel time high)
ğŸ§  Learning: Building experience

Episode 100-300: Learning Patterns
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ¯ Agent starts recognizing patterns
ğŸ“Š Metrics: Improving (30% better)
ğŸ§  Learning: Finding good strategies

Episode 300-500: Fine-tuning
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
âœ¨ Agent exploits learned policy
ğŸ“Š Metrics: Near-optimal (45% better)
ğŸ§  Learning: Polishing decisions
```

### Convergence Pattern

```
Travel Time over Episodes:

300sâ”‚ â—
    â”‚   â—
250sâ”‚     â—
    â”‚       â—â—
200sâ”‚          â—â—â—
    â”‚             â—â—â—
150sâ”‚                â—â—â—â—
    â”‚                    â—â—â—â—â—
100sâ”‚                         â—â—â—â—â—â—â—
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    0   100   200   300   400   500
              Episodes

â— = Average travel time per episode
```

---

## ğŸš€ Part 11: Quick Start Workflow

### Step-by-Step Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: Install CityFlow            â”‚
â”‚ $ pip install cityflow              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: Generate Config Files       â”‚
â”‚ $ python cityflow_complete_setup.py â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 3: Test Installation           â”‚
â”‚ $ python test_cityflow.py           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 4: Integrate PressLight        â”‚
â”‚ Use CityFlowPressLightWrapper       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 5: Train Agent                 â”‚
â”‚ - 500 episodes                      â”‚
â”‚ - Proper epsilon decay              â”‚
â”‚ - Monitor metrics                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 6: Evaluate Results            â”‚
â”‚ Compare: PressLight vs Baselines    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’» Part 12: Code Integration Example

### Complete Minimal Example

```python
import cityflow
import numpy as np

# 1. Initialize CityFlow
eng = cityflow.Engine("cityflow_data/config.json")

# 2. Define state extraction
def get_state(eng, intersection_id):
    phase = eng.get_current_phase(intersection_id)
    lane_vehicles = eng.get_lane_vehicles()
    
    # Build 18-dim state (simplified)
    state = [1 if phase == 0 else 0, 1 if phase == 1 else 0]
    # ... add lane vehicle counts ...
    
    return np.array(state)

# 3. Training loop
for episode in range(500):
    eng.reset()
    
    for step in range(3600):
        # Get state
        state = get_state(eng, "intersection_1")
        
        # Agent selects action
        action = agent.act(state)
        
        # Execute in CityFlow
        eng.set_tl_phase("intersection_1", action)
        eng.next_step()
        
        # Get reward and train
        next_state = get_state(eng, "intersection_1")
        reward = calculate_reward(next_state)
        agent.train(state, action, reward, next_state)
    
    # Evaluate episode
    metrics = eng.get_vehicle_info()
    print(f"Episode {episode}: Avg speed = {avg_speed(metrics)}")
```

---

## ğŸ“š Additional Resources

### Official Documentation
- **CityFlow Docs**: https://cityflow.readthedocs.io/
- **GitHub**: https://github.com/cityflow-project/CityFlow
- **Paper**: WWW 2019 - "CityFlow: A Multi-Agent Reinforcement Learning Environment"

### Example Networks
- **Single Intersection**: 1x1 grid
- **Arterial**: 2x1, 4x1 configurations
- **Grid Networks**: 2x2, 3x3, 4x4
- **Real-World**: Jinan, Manhattan datasets

### Visualization Tools
- Web-based replay viewer
- Real-time monitoring dashboard
- Matplotlib integration for metrics

---

## âœ… Checklist for Success

- [ ] CityFlow installed and tested
- [ ] Configuration files generated
- [ ] Understanding of state representation
- [ ] Pressure calculation implemented
- [ ] PressLight agent integrated
- [ ] Training with proper hyperparameters
- [ ] Monitoring convergence
- [ ] Achieving target performance (30-50% improvement)

---

**You're now ready to implement PressLight with CityFlow!** ğŸ‰

Follow the artifacts and guides provided, and you'll achieve excellent results. Remember: the key is using CityFlow for realistic simulation and proper hyperparameter tuning.